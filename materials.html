<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cyber Education ‚Äì Materials</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg:#F7F9F6;
      --text:#0B2F28;
      --primary:#0F6B52;
      --accent:#D9B35A;
      --card:#FFFFFF;
      --shadow:rgba(0,0,0,0.08);
      --border:rgba(0,0,0,0.10);
    }
    body{
      margin:0;
      font-family:Montserrat,system-ui;
      background:var(--bg);
      color:var(--text);
      padding:24px;
    }

    .top{
      max-width:1100px;
      margin:0 auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      flex-wrap:wrap;
    }
    h1{margin:0;font-size:30px;letter-spacing:0.2px}
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:999px;
      border:1px solid var(--border);
      background:transparent;
      color:var(--text);
      cursor:pointer;
      font-weight:600;
    }
    .pill:hover{border-color:rgba(0,0,0,0.18)}

    .list{
      max-width:1100px;
      margin:18px auto 0;
      display:flex;
      flex-direction:column;
      gap:14px;
    }

    .row{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:18px;
      padding:16px 16px;
      box-shadow:0 10px 26px var(--shadow);
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:16px;
      flex-wrap:wrap;
    }

    .left{
      min-width:260px;
      flex:1;
    }
    .kicker{
      font-weight:700;
      color:var(--primary);
      margin:0 0 4px;
      font-size:14px;
      letter-spacing:0.2px;
      text-transform:uppercase;
    }
    .title{
      margin:0;
      font-size:20px;
    }
    .desc{
      margin:6px 0 0;
      opacity:0.86;
      line-height:1.45;
    }

    .actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .btn{
      padding:10px 14px;
      border-radius:999px;
      font-weight:700;
      cursor:pointer;
      border:2px solid var(--primary);
      background:transparent;
      color:var(--primary);
      transition:transform .15s ease, background .15s ease, color .15s ease;
      white-space:nowrap;
      text-decoration:none;
      display:inline-block;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.primary{
      background:var(--primary);
      color:#fff;
      border-color:var(--primary);
    }
    .btn.primary:hover{
      background:var(--accent);
      border-color:var(--accent);
      color:#0b1220;
    }

    .note{
      max-width:1100px;
      margin:14px auto 0;
      opacity:.75;
      font-size:13px;
    }

    /* MODAL */
    .modal{
      display:none;
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.7);
      z-index:1000;
      align-items:center;
      justify-content:center;
      padding:20px;
    }
    .modal.show{display:flex}
    
    .modal-card{
      background:var(--card);
      border-radius:24px;
      padding:40px;
      max-width:500px;
      width:100%;
      text-align:center;
      box-shadow:0 20px 60px rgba(0,0,0,0.3);
      position:relative;
    }

    .modal-close{
      position:absolute;
      top:16px;
      right:16px;
      width:36px;
      height:36px;
      border-radius:50%;
      border:none;
      background:var(--bg);
      cursor:pointer;
      font-size:20px;
      color:var(--text);
      display:flex;
      align-items:center;
      justify-content:center;
      transition:transform 0.2s ease;
    }
    .modal-close:hover{transform:rotate(90deg)}

    .modal-title{
      font-size:1.8rem;
      font-weight:900;
      margin-bottom:10px;
      color:var(--primary);
    }

    .modal-subtitle{
      font-size:1rem;
      color:var(--text);
      opacity:0.7;
      margin-bottom:30px;
    }

    .qr-box{
      background:var(--bg);
      border-radius:16px;
      padding:24px;
      margin-bottom:24px;
    }

    .qr-img{
      width:220px;
      height:220px;
      margin:0 auto 16px;
      display:block;
      border-radius:12px;
    }

    .code-display{
      font-size:2rem;
      font-weight:900;
      letter-spacing:4px;
      color:var(--primary);
      margin-bottom:12px;
    }

    .modal-note{
      font-size:0.9rem;
      color:var(--text);
      opacity:0.8;
      margin-bottom:24px;
      line-height:1.6;
    }

    .modal-actions{
      display:flex;
      gap:12px;
      justify-content:center;
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark){
      :root{
        --bg:#0B1010;
        --text:#E9EEE9;
        --primary:#0F6B52;
        --accent:#D9B35A;
        --card:#0B2F28;
        --shadow:rgba(0,0,0,0.6);
        --border:rgba(255,255,255,0.16);
      }
      .pill{color:var(--text)}
      .row{border-color:var(--border)}
      .btn{border-color:var(--primary);color:var(--text)}
    }
  </style>
</head>

<body>
  <header class="top">
    <h1>Presentations</h1>
    <button class="pill" id="lock">Lock</button>
  </header>

  <main class="list" id="list"></main>
  <p class="note">With love, <b>MujMej</b></p>

  <!-- QR MODAL -->
  <div class="modal" id="qrModal">
    <div class="modal-card">
      <button class="modal-close" onclick="closeQR()">‚úï</button>
      <h2 class="modal-title" id="modalTitle">Kviz QR Kod</h2>
      <p class="modal-subtitle" id="modalSubtitle">Skeniraj QR kod ili unesi kod ruƒçno</p>
      
      <div class="qr-box">
        <img class="qr-img" id="qrImage" alt="QR Code" />
        <div class="code-display" id="codeDisplay">----</div>
      </div>

      <p class="modal-note">
        üì± Uƒçenici skeniraju ovaj QR kod mobilnim telefonom<br>
        üíª Na velikom ekranu vide kod koji unose u kviz
      </p>

      <div class="modal-actions">
        <button class="btn" onclick="closeQR()">Zatvori</button>
        <a class="btn primary" id="startQuizBtn" target="_blank">Pokreni kviz</a>
      </div>
    </div>
  </div>

  <script>
    const KEY="cyberEduUnlocked";
    if(sessionStorage.getItem(KEY)!=="true"){
      location.href="index.html";
    }

    document.getElementById("lock").addEventListener("click",()=>{
      sessionStorage.removeItem(KEY);
      location.href="index.html";
    });

    // TOPICS DATA (ID mora odgovarati data.js)
    const topics = [
      {id:"t1",  file:"Tema1.pdf",  topic:"Tema 1",  desc:"Internet kao javni prostor"},
      {id:"t2",  file:"Tema2.pdf",  topic:"Tema 2",  desc:"Digitalni trag"},
      {id:"t3",  file:"Tema3.pdf",  topic:"Tema 3",  desc:"Liƒçni podaci i privatnost"},
      {id:"t4",  file:"Tema4.pdf",  topic:"Tema 4",  desc:"Lozinke i za≈°tita naloga"},
      {id:"t5",  file:"Tema5.pdf",  topic:"Tema 5",  desc:"Ko je s druge strane ekrana?"},
      {id:"t6",  file:"Tema6.pdf",  topic:"Tema 6",  desc:"Dru≈°tvene mre≈æe i uticaj na mozak"},
      {id:"t7",  file:"Tema7.pdf",  topic:"Tema 7",  desc:"Cyberbullying i pozitivna zajednica"},
      {id:"t8",  file:"Tema8.pdf",  topic:"Tema 8",  desc:"La≈æne vijesti i kritiƒçko razmi≈°ljanje"},
      {id:"t9",  file:"Tema9.pdf",  topic:"Tema 9",  desc:"AI i deepfake tehnologija"},
      {id:"t10", file:"Tema10.pdf", topic:"Tema 10", desc:"Incident response"},
    ];

    const list = document.getElementById("list");

    list.innerHTML = topics.map(t => `
      <section class="row">
        <div class="left">
          <div class="kicker">${t.topic}</div>
          <h2 class="title">${t.desc}</h2>
        </div>

        <div class="actions">
          <button class="btn primary" onclick="location.href='viewer.html?f=${encodeURIComponent(t.file)}'">üìÑ Prezentacija</button>
          <button class="btn" onclick="showQR('${t.id}','A')">üîê Kviz A</button>
          <button class="btn" onclick="showQR('${t.id}','B')">üîê Kviz B</button>
        </div>
      </section>
    `).join("");

    // QR CODE GENERATION
    function genCode(len=4){
      const chars = "ABCDEFGHJKMNPQRSTUVWXYZ23456789";
      let out = "";
      for(let i=0;i<len;i++){
        out += chars[Math.floor(Math.random()*chars.length)];
      }
      return out;
    }

    function buildQrUrl(code){
      const base = location.origin + location.pathname.replace(/materials\.html$/, "quiz/verify.html");
      return base + "?code=" + encodeURIComponent(code);
    }

    function setQrImage(imgEl, qrUrl){
      const url = "https://api.qrserver.com/v1/create-qr-code/?size=220x220&data=" + encodeURIComponent(qrUrl);
      imgEl.src = url;
    }

    // GENERATE PERSISTENT CODE (per topic + part)
    function getPersistentCode(topicId, part){
      const key = `qr_code_${topicId}_${part}`;
      let code = localStorage.getItem(key);
      if(!code){
        code = genCode(4);
        localStorage.setItem(key, code);
      }
      return code;
    }

    function showQR(topicId, part){
      const topic = topics.find(t=>t.id===topicId);
      if(!topic) return;

      const code = getPersistentCode(topicId, part);
      const qrUrl = buildQrUrl(code);

      document.getElementById("modalTitle").textContent = `${topic.topic} ‚Äì Kviz ${part}`;
      document.getElementById("modalSubtitle").textContent = topic.desc;
      document.getElementById("codeDisplay").textContent = code;
      setQrImage(document.getElementById("qrImage"), qrUrl);

      // Quiz link (educator direct access)
      const quizUrl = `quiz/index.html#topic=${topicId}&part=${part}`;
      document.getElementById("startQuizBtn").href = quizUrl;

      document.getElementById("qrModal").classList.add("show");
    }

    function closeQR(){
      document.getElementById("qrModal").classList.remove("show");
    }

    // Close modal on outside click
    document.getElementById("qrModal").addEventListener("click", (e)=>{
      if(e.target.id === "qrModal") closeQR();
    });
  </script>
</body>
</html>
